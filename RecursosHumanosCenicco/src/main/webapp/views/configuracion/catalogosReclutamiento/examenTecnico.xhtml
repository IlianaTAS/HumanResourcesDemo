<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="../../../templates/templateMenu.xhtml">
            <ui:define name="content">
                <p:growl id="growl" showDetail="false" life="3000"/>
                <p:layout id="idLayOutExamen" style="min-height:92%">
                    <p:layoutUnit position="west" resizable="false" size="27%">
                        <h:form>
                            <div align ="center">
                                <h:panelGrid columns="2" style="font-size: .8em;">
                                    <h:outputText value="Tipo Examen: " />
                                    <p:selectOneMenu style="color:black; width:200px"
                                                     value="#{examenController.tipoExamen}"
                                                     required="true"  requiredMessage="Favor de seleccionar el tipo de examen" 
                                                     filter="true" filterMatchMode="contains">
                                        <p:ajax listener="#{examenController.onChangeExamen}" update="panelPuestos"/>
                                        <f:selectItem itemLabel="Seleccione" itemValue=""/>
                                        <f:selectItem itemLabel="Examen Técnico" itemValue="EXAMEN_TECNICO"/>
                                        <f:selectItem itemLabel="Examen Psicométrico" itemValue="EXAMEN_PSICOMETRICO"/>
                                    </p:selectOneMenu>
                                </h:panelGrid>
                            </div>
                            <br/>    
                            <p:accordionPanel id="panelPuestos" value="#{examenController.listaPuestos}" var="puesto" styleClass="style_tab_color">
                                <p:tab title="#{puesto.descripcion}">
                                    <h:panelGrid>
                                        <p:dataTable value="#{puesto.listExamenes}" var="examenPuesto" style="font-size: .8em;width: 100%;"
                                                     emptyMessage="Sin exámenes">
                                            <p:column width="85">
                                                <h:outputLabel value="#{examenPuesto.descripcion}"/> 
                                            </p:column>
                                            <p:column width="10" style="align-content: center;">
                                                <p:commandButton icon="ui-icon-arrowthickstop-1-s" styleClass="style_botones" title="Descargar PDF"/>
                                            </p:column>
                                            <p:column width="10" style="align-content: center;">
                                                <p:commandButton icon="ui-icon-trash" styleClass="style_botones" title="Eliminar examen"
                                                                 actionListener="#{examenController.parametroExamenEliminar}"
                                                                 oncomplete="PF('eliminarExamenDlg').show()">
                                                    <f:attribute name="examenEliminar" value="#{examenPuesto}"/>
                                                </p:commandButton>
                                            </p:column>
                                        </p:dataTable> 
                                    </h:panelGrid>
                                </p:tab>
                            </p:accordionPanel>
                        </h:form>
                    </p:layoutUnit>

                    <p:layoutUnit position="center">
                        <h:form style="margin-top:5%; font-size: .8em;">
                            <p:growl id="growl" sticky="true" showDetail="true"/>
                            <div align="center">
                                <p:wizard id="wizExamen" style="width: 85%; height: 90%; font-size: .9em;" nextLabel="Siguiente" backLabel="Atrás" 
                                          flowListener="#{examenController.wizardExamen}">
                                    <p:tab id="configuracion" title="Configuración" titleStyleClass="style_tab">
                                        <p:panel header="Ingrese la estructura del exámen">
                                            <h:panelGrid columns="3">
                                                <h:outputText value="Tipo Examen: *" />
                                                <p:selectOneMenu id="idTipoE" style="color:black; width:230px"
                                                                 value="#{examenController.examen.catalogoParametro.valor}"
                                                                 required="true"  requiredMessage="Favor de seleccionar el tipo de examen" 
                                                                 filter="true" filterMatchMode="contains">
                                                    <f:selectItem itemLabel="Seleccione" itemValue=""/>
                                                    <f:selectItem itemLabel="Examen Técnico" itemValue="EXAMEN_TECNICO"/>
                                                    <f:selectItem itemLabel="Examen Psicométrico" itemValue="EXAMEN_PSICOMETRICO"/>
                                                </p:selectOneMenu>
                                                <p:message for="idTipoE"/>
                                                <h:outputText value="Nombre: *" />
                                                <p:inputText id="idNombre" style="color: black;width: 250px;" value="#{examenController.examen.descripcion}"
                                                             required="true" requiredMessage="Favor de ingresar el nombre del exámen"/>
                                                <p:message for="idNombre" />
                                                <h:outputText value="Puesto: *" />
                                                <p:selectOneMenu id="idPuesto" style="color:black; width:230px"
                                                                 value="#{examenController.examen.puesto.idPuesto}"
                                                                 required="true"  requiredMessage="Favor de seleccionar el puesto" 
                                                                 filter="true" filterMatchMode="contains">
                                                    <f:selectItem itemLabel="Seleccione" itemValue=""/>
                                                    <f:selectItems value="#{examenController.listaPuestos}" var="puesto"
                                                                   itemValue="#{puesto.idPuesto}" itemLabel="#{puesto.descripcion}"/>
                                                </p:selectOneMenu>
                                                <p:message for="idPuesto" />

                                                <h:outputText value="Duración(horas): *" />
                                                <p:inputText id="idDuracion" style="color: black;" value="#{examenController.examen.duracion}"
                                                             required="true" requiredMessage="Favor de ingresar la duración del exámen"/>
                                                <p:message for="idDuracion" />

                                                <h:outputText value="Cantidad de preguntas abiertas: *" />
                                                <p:inputText id="idPreguntasA" style="color: black;" value="#{examenController.examenDTO.peguntasAbiertas}"
                                                             required="true" requiredMessage="Favor de ingresar la cantidad de preguntas abiertas"/>
                                                <p:message for="idPreguntasA" />

                                                <h:outputText value="Cantidad de preguntas cerradas: *" />
                                                <p:inputText id="idPreguntasC" style="color: black;" value="#{examenController.examenDTO.preguntasCerradas}"
                                                             required="true" requiredMessage="Favor de ingresar la cantidad de preguntas cerradas"/>
                                                <p:message for="idPreguntasC" />

                                                <h:outputText value="Cantidad de preguntas de opción multiple: *" />
                                                <p:inputText id="idPreguntaM" style="color: black;" value="#{examenController.examenDTO.preguntasMultiples}"
                                                             required="true" requiredMessage="Favor de ingresar la cantida de preguntas de opción múltiple"/>
                                                <p:message for="idPreguntaM" />

                                            </h:panelGrid>
                                        </p:panel>
                                    </p:tab>

                                    <p:tab id="pregunta" title="Preguntas" titleStyleClass="style_tab">
                                        <div align="left">
                                            <p:panel header="Ingresar las preguntas y posibles respuestas del examen">

                                                <p:accordionPanel>
                                                    <p:tab title="Preguntas abiertas" titleStyleClass="style_tab_color">
                                                        <p:dataTable value="#{examenController.preguntasAbiertas}" var="preguntaA" editable="true" editMode="cell"
                                                                     scrollable="true" scrollHeight="150">
                                                            <p:column headerText="No." style="width: 10%;">
                                                                <h:outputLabel value="#{preguntaA.numero}"/>
                                                            </p:column>
                                                            <p:column headerText="Pregunta" style="width: 90%;">
                                                                <p:cellEditor>
                                                                    <f:facet name="output"><h:outputText value="#{preguntaA.pregunta}"/></f:facet>
                                                                    <f:facet name="input"><p:inputText value="#{preguntaA.pregunta}" style="width:97%"/></f:facet>
                                                                </p:cellEditor>
                                                            </p:column>
                                                        </p:dataTable>
                                                    </p:tab>
                                                    <p:tab title="Preguntas cerradas" titleStyleClass="style_tab_color">
                                                        <p:dataTable value="#{examenController.preguntasCerradas}" var="preguntaC" editable="true" editMode="cell"
                                                                     scrollable="true" scrollHeight="150">
                                                            <p:column headerText="No." style="width: 10%;">
                                                                <h:outputLabel value="#{preguntaC.numero}"/>
                                                            </p:column>
                                                            <p:column headerText="Pregunta" style="width: 90%;">
                                                                <p:cellEditor>
                                                                    <f:facet name="output"><h:outputText value="#{preguntaC.pregunta}"/></f:facet>
                                                                    <f:facet name="input"><p:inputText value="#{preguntaC.pregunta}" style="width:97%"/></f:facet>
                                                                </p:cellEditor>
                                                            </p:column>
                                                        </p:dataTable>
                                                    </p:tab>
                                                    <p:tab title="Preguntas opción múltiple" titleStyleClass="style_tab_color">
                                                        <p:dataTable value="#{examenController.preguntasMultiples}" var="preguntaM" editable="true" editMode="cell"
                                                                     scrollable="true" scrollHeight="150">
                                                            <p:column headerText="No." style="width: 5%;">
                                                                <h:outputLabel value="#{preguntaM.numero}"/>
                                                            </p:column>
                                                            <p:column headerText="Pregunta" style="width: 32%;">
                                                                <p:cellEditor>
                                                                    <f:facet name="output"><h:outputText value="#{preguntaM.pregunta}"/></f:facet>
                                                                    <f:facet name="input"><p:inputText value="#{preguntaM.pregunta}" style="width:90%"/></f:facet>
                                                                </p:cellEditor>
                                                            </p:column>
                                                            <p:column headerText="Respuesta Correcta" style="width: 16%;">
                                                                <p:cellEditor>
                                                                    <f:facet name="output"><h:outputText value="#{preguntaM.respuestaC}"/></f:facet>
                                                                    <f:facet name="input"><p:inputText value="#{preguntaM.respuestaC}" style="width:90%"/></f:facet>
                                                                </p:cellEditor>
                                                            </p:column>
                                                            <p:column headerText="Respuesta Incorrecta" style="width: 16%;">
                                                                <p:cellEditor>
                                                                    <f:facet name="output"><h:outputText value="#{preguntaM.respuestaE1}"/></f:facet>
                                                                    <f:facet name="input"><p:inputText value="#{preguntaM.respuestaE1}" style="width:90%"/></f:facet>
                                                                </p:cellEditor>
                                                            </p:column>
                                                            <p:column headerText="Respuesta Incorrecta" style="width: 16%;">
                                                                <p:cellEditor>
                                                                    <f:facet name="output"><h:outputText value="#{preguntaM.respuestaE2}"/></f:facet>
                                                                    <f:facet name="input"><p:inputText value="#{preguntaM.respuestaE2}" style="width:97%"/></f:facet>
                                                                </p:cellEditor>
                                                            </p:column>
                                                        </p:dataTable>
                                                    </p:tab>
                                                </p:accordionPanel>
                                            </p:panel>
                                        </div>
                                    </p:tab>

                                    <p:tab id="confirmacion" title="Confirmación" titleStyleClass="style_tab">
                                        <div align="center">
                                            <h3 style="margin-top:0">El examen que se creará es el siguiente:</h3>
                                            <p:panel>
                                                <h:panelGrid style="font-size: .9em" columns="4" cellspacing="7">
                                                    <h:outputLabel value="Nombre:"/>
                                                    <h:outputLabel value="#{examenController.examen.descripcion}" style="color: green; font-weight: bold"/>
                                                    <h:outputLabel value="Puesto"/>
                                                    <h:outputLabel value="#{examenController.puestoE.descripcion}" style="color: green; font-weight: bold"/>
                                                    <h:outputLabel value="Duración"/>
                                                    <h:outputLabel value="#{examenController.examen.duracion} hora(s)" style="color: green; font-weight: bold"/>
                                                    <h:outputLabel value="Cantidad preguntas abiertas"/>
                                                    <h:outputLabel value="#{examenController.examenDTO.peguntasAbiertas}" style="color: green; font-weight: bold"/>
                                                    <h:outputLabel value="Cantidad preguntas cerradas"/>
                                                    <h:outputLabel value="#{examenController.examenDTO.preguntasCerradas}" style="color: green; font-weight: bold"/>
                                                    <h:outputLabel value="Duración preguntas múltiples"/>
                                                    <h:outputLabel value="#{examenController.examenDTO.preguntasMultiples}" style="color: green; font-weight: bold"/>
                                                </h:panelGrid>
                                            </p:panel>
                                        </div>
                                        <div align="left">
                                            <p:scrollPanel style="height: 200px;">
                                                <h:panelGrid style="font-size: .9em" columns="1">
                                                    <h3 style="margin-top:0;color: green">Preguntas abiertas:</h3>
                                                    <p:repeat value="#{examenController.preguntasAbiertas}" var="pregA">
                                                        <p:outputPanel rendered="#{not empty pregA.pregunta}">
                                                            <h:panelGrid columns="2">
                                                                <h:outputText value="#{pregA.numero}.- #{pregA.pregunta}" style="font-weight: bold"/>
                                                            </h:panelGrid>
                                                        </p:outputPanel>
                                                    </p:repeat>
                                                    <br/><br/>
                                                    <h3 style="margin-top:0;color: green">Preguntas cerradas:</h3>
                                                    <p:repeat value="#{examenController.preguntasCerradas}" var="pregC">
                                                        <p:outputPanel rendered="#{not empty pregC.pregunta}">
                                                            <h:panelGrid columns="1">
                                                                <h:outputText value="#{pregC.numero}.- #{pregC.pregunta}" style="font-weight: bold"/>
                                                                <p:selectOneRadio>
                                                                    <f:selectItem itemValue="si" itemLabel="si"/>
                                                                    <f:selectItem itemValue="no" itemLabel="no"/>
                                                                </p:selectOneRadio>
                                                            </h:panelGrid>
                                                        </p:outputPanel>
                                                    </p:repeat>
                                                    <br/><br/>
                                                    <h3 style="margin-top:0;color: green">Preguntas múltiples:</h3>
                                                    <p:repeat value="#{examenController.preguntasMultiples}" var="pregM">
                                                        <p:outputPanel rendered="#{not empty pregM.pregunta}">
                                                            <h:panelGrid columns="1">
                                                                <h:outputText value="#{pregM.numero}.- #{pregM.pregunta}" style="font-weight: bold"/>
                                                                <p:selectOneRadio>
                                                                    <f:selectItem itemValue="#{pregM.respuestaC}" itemLabel="#{pregM.respuestaC}"/>
                                                                    <f:selectItem itemValue="#{pregM.respuestaE1}" itemLabel="#{pregM.respuestaE1 }"/>
                                                                    <f:selectItem itemValue="#{pregM.respuestaE2}" itemLabel="#{pregM.respuestaE2}"/>
                                                                </p:selectOneRadio>
                                                            </h:panelGrid>
                                                        </p:outputPanel>
                                                    </p:repeat>
                                                </h:panelGrid>
                                                <div align="right">
                                                    <p:commandButton value="Guardar" icon="ui-icon-disk" styleClass="style_botones"
                                                                     actionListener="#{examenController.crearExamen}"
                                                                     update="idLayOutExamen, :growl"/>
                                                </div>
                                            </p:scrollPanel>
                                        </div>
                                    </p:tab>
                                </p:wizard>
                            </div>

                        </h:form>

                    </p:layoutUnit>
                </p:layout>

                <h:form id="formEliminar">
                    <p:dialog id="display" widgetVar="eliminarExamenDlg"
                              header="Confirmación" resizable="false" position="center,center"
                              showEffect="fade" hideEffect="explode" closable="false"
                              modal="true">

                        <h:panelGrid columns="3" cellpadding="5">
                            <h:outputLabel value="¿Esta seguro de eliminar el registro?" />
                        </h:panelGrid>
                        <f:facet name="footer">
                            <h:panelGrid columns="2">
                                <p:commandButton value="Si" icon="ui-icon-check"
                                                 actionListener="#{examenController.eliminarExamen}"
                                                 styleClass="style_botones"
                                                 update="formEliminar:display, :growl, idLayOutExamen" />
                                <p:commandButton value="No" icon="ui-icon-close"
                                                 onclick="PF('eliminarExamenDlg').hide();"
                                                 styleClass="style_botones">
                                </p:commandButton>
                            </h:panelGrid>
                        </f:facet>
                    </p:dialog>
                </h:form>
            </ui:define>
        </ui:composition>
    </body>
</html>
